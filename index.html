<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Culture Shift: Leadership Pathways â€” Full Prototype</title>
  <style>
    :root{
      --bg:#0b0f17; --panel:#121a2a; --panel2:#0f1626; --line:#22304e; --line2:#2d3e66;
      --txt:#e8eefc; --muted:rgba(232,238,252,.82);
      --good:#1f7a4a; --warn:#a6771a; --bad:#9a2a2a;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--txt);font-family:system-ui,Segoe UI,Arial}
    .wrap{max-width:1100px;margin:0 auto;padding:22px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:18px;padding:16px;margin:14px 0;box-shadow:0 10px 28px rgba(0,0,0,.22)}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .sp{flex:1}
    .h1{font-size:18px;margin:0 0 6px}
    .h2{font-size:13px;margin:0 0 8px;opacity:.92}
    .muted{color:var(--muted)}
    .pill{display:inline-flex;gap:8px;align-items:center;padding:7px 10px;border-radius:999px;background:#1a2440;border:1px solid var(--line2);font-size:12px}
    .tabs{display:flex;gap:10px;flex-wrap:wrap}
    .tab{padding:9px 12px;border-radius:12px;background:#16203a;border:1px solid var(--line2);cursor:pointer;font-size:13px}
    .tab.active{background:#233055}
    button{background:#1f2b46;color:var(--txt);border:1px solid var(--line2);border-radius:12px;padding:10px 12px;cursor:pointer}
    button:hover{filter:brightness(1.08)}
    button.ghost{background:transparent}
    button.danger{border-color:#6e2a2a;background:#2a1515}
    button.good{border-color:#276b44;background:#102017}
    .grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px}
    @media (max-width:900px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr));} }
    .stat{background:var(--panel2);border:1px solid var(--line);border-radius:14px;padding:10px}
    .stat .k{font-size:12px;opacity:.85}
    .stat .v{font-size:18px;margin-top:2px}
    .meter{height:10px;border-radius:999px;background:#0b1020;border:1px solid var(--line);overflow:hidden;margin-top:8px}
    .bar{height:100%;width:50%}
    .split{display:grid;grid-template-columns:1.2fr .8fr;gap:12px}
    @media (max-width:900px){ .split{grid-template-columns:1fr;} }
    .choiceBtn{width:100%;text-align:left;margin:6px 0}
    .hr{height:1px;background:var(--line);margin:12px 0}
    .mini{font-size:12px;opacity:.85}
    .tag{display:inline-block;padding:6px 9px;border-radius:999px;border:1px solid var(--line2);background:#152141;font-size:12px;margin:4px 6px 0 0}
    .list{display:flex;flex-wrap:wrap}
    .scoreBox{background:#0f1626;border:1px dashed #2d3e66;border-radius:16px;padding:12px}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;background:#0b1020;border:1px solid var(--line);border-radius:10px;padding:2px 6px;font-size:12px}
    a{color:#a8c7ff}
    textarea{width:100%;min-height:120px;border-radius:12px;border:1px solid var(--line2);background:#0b1020;color:var(--txt);padding:10px}
    .hidden{display:none!important}
  </style>
</head>

<body>
<div class="wrap">

  <!-- HEADER -->
  <div class="card">
    <div class="row">
      <div>
        <div class="pill">ğŸŒ The Culture Shift: Leadership Pathways</div>
              </div>
      <div class="sp"></div>
      <button class="ghost" onclick="openHelp()">How to use</button>
      <button class="ghost" onclick="openScorecard()">Scorecard</button>
      <button class="ghost" onclick="openExport()">Export</button>
      <button class="danger" onclick="resetAll()">Reset All</button>
    </div>
    <div class="hr"></div>
    <div class="tabs" id="tabs"></div>
    <div class="mini muted" style="margin-top:10px">
      Tip: Your progress is saved in <span class="kbd">localStorage</span>. You can export a JSON record anytime.
    </div>
  </div>

<!-- MAIN PLAY AREA -->
  <div class="card" id="playCard">
    <div class="row">
      <div class="pill" id="seasonPill">Season â€”</div>
      <div class="pill" id="episodePill">Episode â€”</div>
      <div class="sp"></div>
      <button class="ghost" onclick="prevScene()">â† Back</button>
      <button class="ghost" onclick="nextScene()">Next â†’</button>
    </div>
    <div class="hr"></div>

    <div id="sceneTitle" class="h1"></div>
    <div id="sceneText" class="muted" style="white-space:pre-wrap"></div>

    <div class="hr"></div>
    <div class="h2">Choose your response</div>
    <div id="choices"></div>

    <div id="outcomeCard" class="card hidden" style="margin:12px 0 0;background:#0f1626;border-style:dashed">
      <div class="h2">Outcome</div>
      <div class="muted" id="outcomeStats"></div>
      <div class="hr"></div>
      <div><b>Profile reveal:</b> <span id="outcomeReveal"></span></div>
      <div class="hr"></div>
      <div class="row">
        <button class="good" onclick="nextScene()">Continue</button>
        <button class="ghost" onclick="openScorecard()">View Scorecard</button>
        <button class="ghost" onclick="closeOutcome()">Close</button>
      </div>
    </div>
  </div>



  <!-- DASHBOARD -->
  <div class="card">
    <div class="row">
      <div class="h2">Live Dashboard (persistent across all seasons)</div>
      <div class="sp"></div>
      <div class="pill" id="badgePill">Badge: â€”</div>
      <div class="pill" id="archetypePill">Archetype: â€”</div>
    </div>

    <div class="grid" style="margin-top:10px">
      <div class="stat">
        <div class="k">Trust</div><div class="v" id="trust">50</div>
        <div class="meter"><div class="bar" id="trustBar"></div></div>
      </div>
      <div class="stat">
        <div class="k">Retention Risk</div><div class="v" id="risk">50</div>
        <div class="meter"><div class="bar" id="riskBar"></div></div>
      </div>
      <div class="stat">
        <div class="k">Team Morale</div><div class="v" id="morale">50</div>
        <div class="meter"><div class="bar" id="moraleBar"></div></div>
      </div>
      <div class="stat">
        <div class="k">AI Adoption Readiness</div><div class="v" id="ai">50</div>
        <div class="meter"><div class="bar" id="aiBar"></div></div>
      </div>
    </div>

    <div class="hr"></div>

    <div class="split">
      <div class="scoreBox">
        <div class="h2">Trait Signals (built from your choices)</div>
        <div class="list" id="traitTags"></div>
        <div class="mini muted" style="margin-top:8px">
          These traits update as you play. Your â€œshadow traitsâ€ appear in the Scorecard.
        </div>
      </div>

      <div class="scoreBox">
        <div class="h2">Unlocked Mini-Games</div>
        <div class="list" id="miniTags"></div>
        <div class="mini muted" style="margin-top:8px">
          Unlocks trigger when you choose certain options (e.g., Stress Heatmap, Feedback Elevator).
        </div>
      </div>
    </div>
  </div>


<!-- MODALS -->
  <div class="card hidden" id="helpCard">
    <div class="row">
      <div class="h1">How to use this prototype</div>
      <div class="sp"></div>
      <button class="ghost" onclick="closeHelp()">Close</button>
    </div>
    <div class="hr"></div>
    <div class="muted" style="line-height:1.5">
      <div class="tag">1) Pick a Season tab</div>
      <div class="tag">2) Make choices per episode</div>
      <div class="tag">3) Watch metrics + trait signals update</div>
      <div class="tag">4) Open Scorecard to see shadow traits + roadmap</div>
      <div class="tag">5) Export JSON to store results</div>
      <div style="margin-top:10px">
        The prototype uses simplified scoring and can be expanded into:
        branching scenes, video placeholders, character art, and deeper mini-games.
      </div>
    </div>
  </div>

  <div class="card hidden" id="scoreCard">
    <div class="row">
      <div class="h1">Leadership Scorecard</div>
      <div class="sp"></div>
      <button class="ghost" onclick="closeScorecard()">Close</button>
    </div>
    <div class="hr"></div>
    <div class="split">
      <div class="scoreBox">
        <div class="h2">Your Archetype & Badge</div>
        <div class="pill" id="scoreArchetype">Archetype: â€”</div>
        <div class="pill" id="scoreBadge" style="margin-left:8px">Badge: â€”</div>
        <div class="hr"></div>
        <div class="h2">Shadow Traits (likely blind spots)</div>
        <div class="list" id="shadowTags"></div>
        <div class="mini muted" style="margin-top:8px">
          Shadow traits appear when your metric pattern suggests overuse of a strength.
        </div>
      </div>
      <div class="scoreBox">
        <div class="h2">30-Day Development Roadmap</div>
        <div class="muted" id="roadmap" style="white-space:pre-wrap;line-height:1.45"></div>
      </div>
    </div>
  </div>

  <div class="card hidden" id="exportCard">
    <div class="row">
      <div class="h1">Export / Import</div>
      <div class="sp"></div>
      <button class="ghost" onclick="closeExport()">Close</button>
    </div>
    <div class="hr"></div>

    <div class="split">
      <div class="scoreBox">
        <div class="h2">Export JSON</div>
        <div class="mini muted">Click export, then save the JSON file or paste it into your LMS.</div>
        <div class="hr"></div>
        <button onclick="exportJSON()">Export to Textarea</button>
        <button class="ghost" onclick="downloadJSON()" style="margin-left:8px">Download .json</button>
        <div class="hr"></div>
        <textarea id="jsonArea" placeholder="Your export will appear here..."></textarea>
      </div>
      <div class="scoreBox">
        <div class="h2">Import JSON</div>
        <div class="mini muted">Paste a previous export and click Import.</div>
        <div class="hr"></div>
        <textarea id="importArea" placeholder="Paste JSON here..."></textarea>
        <div class="hr"></div>
        <button class="good" onclick="importJSON()">Import</button>
      </div>
    </div>
  </div>

</div>

<script>
/* =========================
   DATA: Seasons / Episodes
   ========================= */

const SEASONS = [
  {
    id:"S1",
    name:"Season 1 â€” Foundations",
    subtitle:"Relationships â€¢ Stress â€¢ Feedback",
    episodes:[
      {
        ep:"E1",
        title:"Episode 1 â€” The First Crack",
        sceneTitle:"Chapter 1: The First Crack",
        text:`Your top performer, Alex, has been quiet lately.\nToday they ask for 10 minutes.\n\nAlex:\nâ€œHeyâ€¦ just letting you know, Iâ€™m not sure this role is for me anymore.â€`,
        miniUnlocks:[],
        choices:[
          {
            label:"A) â€œIf this is about workload, we all have pressure. Push through.â€",
            delta:{trust:-15,risk:+40,morale:-10,ai:0},
            reveal:"Risk of Blind Leadership (task-first, empathy-low).",
            traits:{task_focus:+2, empathy:-2, conflict_tolerance:+1},
            unlock:[]
          },
          {
            label:"B) â€œThanks for sharing. Tell me whatâ€™s been on your mind.â€",
            delta:{trust:+25,risk:-20,morale:+10,ai:+5},
            reveal:"Relational Leader with Coaching Strength (creates safety).",
            traits:{empathy:+2, coaching:+2, self_awareness:+1},
            unlock:["Deeper Reveal Dialogue"]
          },
          {
            label:"C) â€œWhat would make you excited to stay?â€",
            delta:{trust:+10,risk:-10,morale:+5,ai:+10},
            reveal:"Solution-Oriented Leader (personalizes motivation).",
            traits:{coaching:+1, adaptability_ai:+2, self_awareness:+1},
            unlock:["Motivation Personalization"]
          },
          {
            label:"D) â€œLetâ€™s go through your KPIs.â€",
            delta:{trust:-10,risk:+20,morale:-5,ai:+5},
            reveal:"Operational Prioritizer (structure high, people-skill gap).",
            traits:{task_focus:+2, empathy:-1, coaching:-1},
            unlock:["KPI Drilldown"]
          }
        ]
      },
      {
        ep:"E2",
        title:"Episode 2 â€” The Invisible Load",
        sceneTitle:"Chapter 2: The Smile That Slipped",
        text:`Maya is delivering but looks strained: faster typing, no breaks, apologizes for everything.\n\nMaya:\nâ€œCan we talk 10 mins? Iâ€™m fineâ€¦ just tired.â€`,
        choices:[
          {
            label:"A) â€œYouâ€™re doing great. Hang in thereâ€”temporary period.â€",
            delta:{trust:-5,risk:+15,morale:-5,ai:0},
            reveal:"Comforting but minimizing (stress remains unspoken).",
            traits:{empathy:-1, resilience:+1, coaching:-1},
            unlock:[]
          },
          {
            label:"B) â€œWalk me through your last 2 daysâ€”what drains you most?â€",
            delta:{trust:+20,risk:-15,morale:+10,ai:+5},
            reveal:"Supportive + diagnostic (Stress Heatmap unlocked).",
            traits:{empathy:+2, coaching:+1, self_awareness:+1},
            unlock:["Stress Heatmap"]
          },
          {
            label:"C) â€œIâ€™m noticing overcompensationâ€”what happens if you slow down?â€",
            delta:{trust:+10,risk:-10,morale:+5,ai:+10},
            reveal:"Deep coaching (Overcompensation Detector unlocked).",
            traits:{coaching:+2, self_awareness:+2, conflict_tolerance:+1},
            unlock:["Overcompensation Detector"]
          },
          {
            label:"D) â€œAre you still on track with targets?â€",
            delta:{trust:-10,risk:+20,morale:-10,ai:0},
            reveal:"Business-first, emotion-miss (risk escalates).",
            traits:{task_focus:+2, empathy:-2},
            unlock:[]
          }
        ]
      },
      {
        ep:"E3",
        title:"Episode 3 â€” The Feedback Spiral",
        sceneTitle:"Chapter 3: The Same Mistake",
        text:`Alex made a high-impact mistakeâ€”twice. Client escalation risk is rising.\n\nAlex:\nâ€œIâ€™m doing my best. This is nitpicking.â€`,
        choices:[
          {
            label:"A) â€œIf you canâ€™t handle feedback, thatâ€™s a bigger problem.â€",
            delta:{trust:-20,risk:+25,morale:-10,ai:-5},
            reveal:"Harsh truth without safety (Feedback Elevator drops).",
            traits:{conflict_tolerance:+2, empathy:-2, coaching:-1},
            unlock:["Feedback Elevator"]
          },
          {
            label:"B) â€œSeparate intent from impact. Hereâ€™s what happened, the risk, and the standard.â€",
            delta:{trust:+15,risk:-10,morale:+10,ai:+10},
            reveal:"Balanced accountability (Empathy Coins +2).",
            traits:{coaching:+2, empathy:+1, task_focus:+1},
            unlock:["Feedback Elevator","Empathy Coins"]
          },
          {
            label:"C) â€œMaybe Iâ€™m overreacting. Letâ€™s forget it.â€",
            delta:{trust:-5,risk:0,morale:-10,ai:-10},
            reveal:"Avoidant (standards erode).",
            traits:{conflict_tolerance:-2, resilience:-1},
            unlock:[]
          },
          {
            label:"D) â€œWhatâ€™s breaking: training, time, tools, or unclear rules?â€",
            delta:{trust:+10,risk:-5,morale:+5,ai:+15},
            reveal:"Systems-minded coaching (process improvement).",
            traits:{adaptability_ai:+2, coaching:+1, task_focus:+1},
            unlock:["Process Fix"]
          }
        ]
      }
    ]
  },

  {
    id:"S2",
    name:"Season 2 â€” Retention & Motivation",
    subtitle:"Flight risk â€¢ Toxic ripple â€¢ Recognition",
    episodes:[
      {
        ep:"E4",
        title:"Episode 4 â€” The Flight Risk",
        sceneTitle:"Chapter 4: The Calendar Block",
        text:`You notice a private calendar block on Jordanâ€™s calendar: â€œInterview â€” confidentialâ€.\nJordan then asks:\nâ€œDo you have 15 minutes today?â€`,
        choices:[
          { label:"A) â€œIf youâ€™re leaving, tell me now so I can plan.â€",
            delta:{trust:-15,risk:+30,morale:-5,ai:0},
            reveal:"Fear-based control (scarcity mindset).",
            traits:{task_focus:+2, empathy:-2, conflict_tolerance:+1},
            unlock:["Retention Radar"]
          },
          { label:"B) â€œI wonâ€™t try to trap youâ€”my goal is to understand whatâ€™s changing.â€",
            delta:{trust:+20,risk:-15,morale:+10,ai:+5},
            reveal:"Safety builder (Retention Radar unlocked).",
            traits:{empathy:+2, coaching:+1, resilience:+1},
            unlock:["Retention Radar"]
          },
          { label:"C) â€œStay/Go map: what makes you stay vs pushes you away?â€",
            delta:{trust:+15,risk:-10,morale:+5,ai:+10},
            reveal:"Structured retention interviewer (Decision Tree unlocked).",
            traits:{coaching:+2, task_focus:+1, self_awareness:+1},
            unlock:["Stay/Go Decision Tree","Talent Map"]
          },
          { label:"D) â€œI canâ€™t change salaryâ€”letâ€™s focus on what I can control.â€",
            delta:{trust:-5,risk:+10,morale:-5,ai:0},
            reveal:"Avoids sensitive topic too early (misses key go-factor).",
            traits:{empathy:-1, conflict_tolerance:-1},
            unlock:[]
          }
        ]
      },
      {
        ep:"E5",
        title:"Episode 5 â€” The Ripple Effect",
        sceneTitle:"Chapter 5: The Joke That Landed Wrong",
        text:`In a team meeting, Sam says sarcastically:\nâ€œHere we go againâ€”another â€˜great ideaâ€™ from leadership.â€\nSome laugh. Two go quiet.`,
        choices:[
          { label:"A) Ignore it and move on.",
            delta:{trust:-5,risk:+10,morale:-10,ai:-5},
            reveal:"Conflict avoided (ripple expands).",
            traits:{conflict_tolerance:-2, resilience:-1},
            unlock:["Ripple Map"]
          },
          { label:"B) â€œPauseâ€”whatâ€™s the real concern, without sarcasm?â€",
            delta:{trust:+15,risk:-5,morale:+10,ai:+5},
            reveal:"Boundary + curiosity (ripple shrinks).",
            traits:{conflict_tolerance:+2, empathy:+1, coaching:+1},
            unlock:["Ripple Map","Fix the Dynamic Puzzle","Team Sentiment Gauge"]
          },
          { label:"C) â€œThatâ€™s unprofessional.â€ (public call-out)",
            delta:{trust:-10,risk:+15,morale:-5,ai:0},
            reveal:"Correct but unsafe delivery (polarization risk).",
            traits:{conflict_tolerance:+1, empathy:-2},
            unlock:["Ripple Map"]
          },
          { label:"D) â€œLetâ€™s take this offlineâ€”Sam, stay after.â€",
            delta:{trust:+5,risk:0,morale:+5,ai:+5},
            reveal:"Tactical de-escalator (repair requires follow-through).",
            traits:{conflict_tolerance:+1, coaching:+1},
            unlock:["Fix the Dynamic Puzzle","Team Sentiment Gauge"]
          }
        ]
      },
      {
        ep:"E6",
        title:"Episode 6 â€” The Recognition Gap",
        sceneTitle:"Chapter 6: The Quiet Win",
        text:`The team hit a tough KPI milestone.\nLina did key behind-the-scenes workâ€”no one mentions it.\nAfter the meeting, Lina looks disengaged.`,
        choices:[
          { label:"A) Generic: â€œGood job everyone.â€",
            delta:{trust:0,risk:+10,morale:0,ai:0},
            reveal:"Misses individuality (micro-disengagement grows).",
            traits:{empathy:-1, coaching:-1},
            unlock:["Recognition Points"]
          },
          { label:"B) Specific: â€œLina, your work unblocked us. What are you proud of?â€",
            delta:{trust:+15,risk:-10,morale:+10,ai:+5},
            reveal:"Precision recognition (Recognition Points +3).",
            traits:{empathy:+2, coaching:+1, self_awareness:+1},
            unlock:["Recognition Points","Motive Cards"]
          },
          { label:"C) Reward-only: â€œIâ€™ll nominate you for a bonus.â€",
            delta:{trust:+5,risk:-5,morale:+5,ai:0},
            reveal:"Helpful but narrow (extrinsic-heavy).",
            traits:{task_focus:+1, empathy:+1},
            unlock:["Recognition Points"]
          },
          { label:"D) Motive Cards: â€œAchievement, Growth, Autonomy, Stability, Masteryâ€”what drives you now?â€",
            delta:{trust:+10,risk:-10,morale:+5,ai:+10},
            reveal:"Personalized motivator (Motivation Profile unlocked).",
            traits:{coaching:+2, adaptability_ai:+1, self_awareness:+2},
            unlock:["Motive Cards","Agent Motivation Profile Quiz"]
          }
        ]
      }
    ]
  },

  {
    id:"S3",
    name:"Season 3 â€” AI-Era Transformation",
    subtitle:"Fear â€¢ Upskilling â€¢ Fatigue",
    episodes:[
      {
        ep:"E7",
        title:"Episode 7 â€” The AI Storm",
        sceneTitle:"Chapter 7: Are We Next?",
        text:`A rumor spreads: â€œAI is replacing our roles.â€\nIn a huddle someone asks:\nâ€œSoâ€¦ should we start looking elsewhere?â€`,
        choices:[
          { label:"A) â€œIgnore rumors. Focus on your work.â€",
            delta:{trust:-10,risk:+20,morale:-10,ai:-10},
            reveal:"Avoids uncertainty (readiness drops).",
            traits:{resilience:-1, empathy:-1},
            unlock:["AI Readiness Meter"]
          },
          { label:"B) â€œHereâ€™s what we know, donâ€™t know, and the next update date.â€",
            delta:{trust:+15,risk:-10,morale:+10,ai:+15},
            reveal:"Transparent stabilizer (Change Comms Simulator).",
            traits:{self_awareness:+1, coaching:+1, adaptability_ai:+2},
            unlock:["Change Communication Simulator","AI Readiness Meter"]
          },
          { label:"C) â€œAI will help usâ€”those who adapt will be fine.â€",
            delta:{trust:+5,risk:0,morale:-5,ai:+10},
            reveal:"Motivating but can feel threatening (tone risk).",
            traits:{adaptability_ai:+2, empathy:-1},
            unlock:["AI Readiness Meter"]
          },
          { label:"D) â€œMap fears â†’ needs, then build a team plan.â€",
            delta:{trust:+20,risk:-15,morale:+10,ai:+10},
            reveal:"Fear-to-action facilitator (Resistance Reduction Game).",
            traits:{coaching:+2, empathy:+1, resilience:+1},
            unlock:["Resistance Reduction Game","AI Readiness Meter"]
          }
        ]
      },
      {
        ep:"E8",
        title:"Episode 8 â€” The Upskilling Pivot",
        sceneTitle:"Chapter 8: Time Is the Problem",
        text:`You announce optional training on AI-assisted workflows.\nTariq says:\nâ€œLove the idea. But when am I supposed to learn this?â€`,
        choices:[
          { label:"A) â€œUpskilling is personal responsibility.â€",
            delta:{trust:-10,risk:+15,morale:-10,ai:+5},
            reveal:"Under-supports learning (culture weak).",
            traits:{task_focus:+2, empathy:-2},
            unlock:["Skill Gap Scanner"]
          },
          { label:"B) â€œWeâ€™ll carve protected learning time and reduce low-value tasks.â€",
            delta:{trust:+15,risk:-10,morale:+10,ai:+15},
            reveal:"Enables growth structurally (Investment Board).",
            traits:{adaptability_ai:+2, coaching:+1, task_focus:+1},
            unlock:["Upskilling Investment Board"]
          },
          { label:"C) â€œSkill Gap Scan: what skill would make next month easier?â€",
            delta:{trust:+10,risk:-5,morale:+5,ai:+15},
            reveal:"Practical developer mindset (Scanner).",
            traits:{coaching:+2, adaptability_ai:+2},
            unlock:["Skill Gap Scanner","Development Path Builder"]
          },
          { label:"D) â€œWeâ€™ll train top performers first.â€",
            delta:{trust:-5,risk:+10,morale:-10,ai:+10},
            reveal:"Creates haves/have-nots (bias risk).",
            traits:{bias_risk:+2, empathy:-1},
            unlock:["Upskilling Investment Board"]
          }
        ]
      },
      {
        ep:"E9",
        title:"Episode 9 â€” The Transformation Pulse",
        sceneTitle:"Chapter 9: Another Initiative",
        text:`You roll out a new process.\nSomeone mutters:\nâ€œGreat. Another change. Weâ€™re exhausted.â€`,
        choices:[
          { label:"A) â€œThis is non-negotiable. Just do it.â€",
            delta:{trust:-15,risk:+15,morale:-15,ai:+5},
            reveal:"Force without care (fatigue worsens).",
            traits:{task_focus:+2, empathy:-2},
            unlock:["Culture Change Dashboard"]
          },
          { label:"B) â€œWe sunset one thing before adding another. What should we stop?â€",
            delta:{trust:+15,risk:-10,morale:+15,ai:+10},
            reveal:"Sustainable change leader (clutter down).",
            traits:{self_awareness:+2, coaching:+1, resilience:+1},
            unlock:["Culture Change Dashboard","Transformation Morale Bar"]
          },
          { label:"C) â€œWhatâ€™s hardest: priorities, tools, rework, emotional load?â€",
            delta:{trust:+10,risk:-5,morale:+10,ai:+10},
            reveal:"Pulse-checker (Morale Bar).",
            traits:{empathy:+1, coaching:+1, self_awareness:+1},
            unlock:["Transformation Morale Bar"]
          },
          { label:"D) â€œAI vs Human Value Cards: what human strengths do we protect?â€",
            delta:{trust:+10,risk:-5,morale:+10,ai:+15},
            reveal:"Meaning-maker (purpose increases).",
            traits:{adaptability_ai:+2, empathy:+1},
            unlock:["AI vs Human Value Cards","Culture Change Dashboard"]
          }
        ]
      }
    ]
  },

  {
    id:"S4",
    name:"Season 4 â€” Performance & Boundaries",
    subtitle:"Accountability â€¢ High performer â€¢ Demotion",
    episodes:[
      {
        ep:"E10",
        title:"Episode 10 â€” The Accountability Mirror",
        sceneTitle:"Chapter 10: Nice, But Slipping",
        text:`Chris is kind and loved, but consistently late on deliverables.\nChris says:\nâ€œIâ€™m tryingâ€¦ Iâ€™ve had a lot going on.â€`,
        choices:[
          { label:"A) â€œNo worriesâ€”take your time.â€",
            delta:{trust:+5,risk:0,morale:-10,ai:-5},
            reveal:"Compassion without accountability (fairness drops).",
            traits:{conflict_tolerance:-2, empathy:+1},
            unlock:["Directness Dial"]
          },
          { label:"B) â€œI careâ€”and reliability still matters. One clear commitment for next week.â€",
            delta:{trust:+15,risk:-5,morale:+10,ai:+10},
            reveal:"Balanced leader (Clarity Checklist).",
            traits:{coaching:+2, task_focus:+1, empathy:+1},
            unlock:["Expectation Clarity Checklist","Boundary Builder","Directness Dial"]
          },
          { label:"C) â€œThis canâ€™t continue. Fix it.â€",
            delta:{trust:-10,risk:+10,morale:-5,ai:+5},
            reveal:"Clear but unsafe (fear-based compliance).",
            traits:{task_focus:+2, empathy:-2, conflict_tolerance:+1},
            unlock:["Directness Dial"]
          },
          { label:"D) â€œWhat support do you needâ€”and what will you stop doing to meet it?â€",
            delta:{trust:+10,risk:-5,morale:+5,ai:+10},
            reveal:"Coaches trade-offs (Boundaries + support).",
            traits:{coaching:+2, self_awareness:+1, empathy:+1},
            unlock:["Boundary Builder","Expectation Clarity Checklist"]
          }
        ]
      },
      {
        ep:"E11",
        title:"Episode 11 â€” The Untouchable High Performer",
        sceneTitle:"Chapter 11: The Eye Roll",
        text:`Nina is a top performerâ€”but undermines peers with sarcasm and eye-rolls.\nA teammate tells you:\nâ€œShe makes us feel small.â€`,
        choices:[
          { label:"A) â€œShe delivers results. Letâ€™s not be sensitive.â€",
            delta:{trust:-15,risk:+20,morale:-20,ai:-5},
            reveal:"Results over culture (toxic talent tolerated).",
            traits:{bias_risk:+2, empathy:-2, task_focus:+2},
            unlock:["Toxic Talent Detector"]
          },
          { label:"B) â€œYour performance is strongâ€”and your influence is hurting the team. Both matter.â€",
            delta:{trust:+10,risk:-5,morale:+15,ai:+5},
            reveal:"Culture-enforcing leader (Influence vs Performance Grid).",
            traits:{conflict_tolerance:+2, coaching:+1, empathy:+1},
            unlock:["Influence vs Performance Grid","Ego Management Toolkit"]
          },
          { label:"C) â€œLetâ€™s all be respectful.â€ (generic)",
            delta:{trust:-5,risk:+10,morale:-5,ai:0},
            reveal:"Avoids the person (behavior persists).",
            traits:{conflict_tolerance:-2},
            unlock:["Team Sentiment Gauge"]
          },
          { label:"D) â€œI want you as a role modelâ€”help raise the bar.â€",
            delta:{trust:+5,risk:0,morale:+5,ai:+5},
            reveal:"Reframes status into leadership (needs clear accountability).",
            traits:{coaching:+1, self_awareness:+1},
            unlock:["Ego Management Toolkit"]
          }
        ]
      },
      {
        ep:"E12",
        title:"Episode 12 â€” The Demotion Dilemma",
        sceneTitle:"Chapter 12: The Closed Door",
        text:`You must demote Elena due to sustained role mismatch.\nElena says:\nâ€œSo all my effort meant nothing?â€`,
        choices:[
          { label:"A) â€œThis is final. HR approved it.â€",
            delta:{trust:-20,risk:+10,morale:-10,ai:0},
            reveal:"Authority shield (dignity loss).",
            traits:{empathy:-2, conflict_tolerance:+1},
            unlock:["Fairness Scale"]
          },
          { label:"B) â€œYour effort matters. This is role fit and impactâ€”not your worth. Hereâ€™s the path forward.â€",
            delta:{trust:+10,risk:-5,morale:+10,ai:+5},
            reveal:"Dignity-first leader (Fairness Scale improves).",
            traits:{empathy:+2, coaching:+1, resilience:+1},
            unlock:["Fairness Scale","Emotional Response Coach"]
          },
          { label:"C) â€œRescue/redirect plan with timelines: scope, team, or transition.â€",
            delta:{trust:+10,risk:-5,morale:+5,ai:+10},
            reveal:"Development-forward, still accountable.",
            traits:{coaching:+2, self_awareness:+1, conflict_tolerance:+1},
            unlock:["Demotion Decision Walkthrough","Emotional Response Coach"]
          },
          { label:"D) â€œI didnâ€™t want this either.â€",
            delta:{trust:-5,risk:0,morale:-5,ai:0},
            reveal:"Avoids ownership (confidence drops).",
            traits:{self_awareness:-1, resilience:-1},
            unlock:[]
          }
        ]
      }
    ]
  },

  {
    id:"S5",
    name:"Season 5 â€” Assets & Fit",
    subtitle:"Potential â€¢ Mismatch â€¢ Finale",
    episodes:[
      {
        ep:"E13",
        title:"Episode 13 â€” The Hidden Gem",
        sceneTitle:"Chapter 13: Quiet, But Rising",
        text:`New hire Sofia is quiet in meetings, but consistently improves processes and helps peers.\nA senior says:\nâ€œSheâ€™s too junior to lead anything.â€`,
        choices:[
          { label:"A) â€œLetâ€™s keep her in her lane.â€",
            delta:{trust:-5,risk:+10,morale:-5,ai:-5},
            reveal:"Status bias (potential ignored).",
            traits:{bias_risk:+2, empathy:-1},
            unlock:["Talent Archetypes"]
          },
          { label:"B) â€œLetâ€™s evaluate behaviors: initiative, learning speed, influence, problem-solving.â€",
            delta:{trust:+10,risk:-10,morale:+5,ai:+10},
            reveal:"Potential-spotter (Strength patterns).",
            traits:{self_awareness:+1, coaching:+1, bias_risk:-1},
            unlock:["Talent Archetypes","Strengths Pattern Game"]
          },
          { label:"C) â€œOwn a small project with check-ins.â€",
            delta:{trust:+15,risk:-10,morale:+5,ai:+10},
            reveal:"Developer-leader (Delegation Simulator).",
            traits:{coaching:+2, task_focus:+1, empathy:+1},
            unlock:["Delegation Simulator"]
          },
          { label:"D) Public â€œtestâ€ in the meeting.",
            delta:{trust:-10,risk:+10,morale:-5,ai:0},
            reveal:"Trial-by-fire (psych safety risk).",
            traits:{empathy:-2, conflict_tolerance:+1},
            unlock:[]
          }
        ]
      },
      {
        ep:"E14",
        title:"Episode 14 â€” The Cultural Mismatch",
        sceneTitle:"Chapter 14: Old World, New Rules",
        text:`Mark is skilled, but dismisses collaboration, refuses new tools, and undermines inclusive norms.\nMark says:\nâ€œThis culture stuff is fluff. Iâ€™m here to get results.â€`,
        choices:[
          { label:"A) â€œFineâ€”just hit your numbers.â€",
            delta:{trust:-15,risk:+20,morale:-20,ai:-10},
            reveal:"Culture erosion (harm tolerated).",
            traits:{task_focus:+2, empathy:-2, bias_risk:+1},
            unlock:["Fit vs Misfit Radar"]
          },
          { label:"B) â€œResults matterâ€”and culture is how we get them. Define 2â€“3 non-negotiables.â€",
            delta:{trust:+5,risk:-5,morale:+10,ai:+5},
            reveal:"Boundary + coaching (Fit Radar).",
            traits:{conflict_tolerance:+2, coaching:+1, empathy:+1},
            unlock:["Fit vs Misfit Radar","Culture Alignment Quiz"]
          },
          { label:"C) â€œRescue or Redirect: support 30â€“60 days, then decide transition ethically.â€",
            delta:{trust:+10,risk:0,morale:+10,ai:+10},
            reveal:"Firm + humane (ethical pathway).",
            traits:{coaching:+2, resilience:+1, self_awareness:+1},
            unlock:["Rescue or Redirect Board","Culture Alignment Quiz"]
          },
          { label:"D) â€œIf you donâ€™t like it, you can leave.â€",
            delta:{trust:-20,risk:+10,morale:-10,ai:0},
            reveal:"Threat-based leadership (retention hit).",
            traits:{empathy:-2, conflict_tolerance:+1},
            unlock:[]
          }
        ]
      },
      {
        ep:"E15",
        title:"Episode 15 â€” Leadership Mirror Finale",
        sceneTitle:"Chapter 15: The Playback",
        text:`A montage plays of your key decisions.\nThe system asks:\nâ€œWhen pressure rises, what do you default to?â€`,
        choices:[
          { label:"A) â€œStructure and KPIs.â€",
            delta:{trust:0,risk:+5,morale:0,ai:+10},
            reveal:"Strong operator; build relational depth.",
            traits:{task_focus:+2, coaching:-1},
            unlock:["Comprehensive Leadership Score"]
          },
          { label:"B) â€œEmpathy and safety.â€",
            delta:{trust:+10,risk:-10,morale:+10,ai:0},
            reveal:"Strong connector; sharpen clarity & standards.",
            traits:{empathy:+2, conflict_tolerance:-1},
            unlock:["Comprehensive Leadership Score"]
          },
          { label:"C) â€œCoaching and growth.â€",
            delta:{trust:+10,risk:-10,morale:+5,ai:+10},
            reveal:"Talent multiplier; sustainable leader.",
            traits:{coaching:+2, adaptability_ai:+1, self_awareness:+1},
            unlock:["Comprehensive Leadership Score","Personalized Learning Path"]
          },
          { label:"D) â€œAvoid conflict until it explodes.â€",
            delta:{trust:-10,risk:+15,morale:-10,ai:-5},
            reveal:"Key dev area: courageous conversations.",
            traits:{conflict_tolerance:-2, resilience:-1},
            unlock:["Comprehensive Leadership Score"]
          }
        ]
      }
    ]
  }
];

/* =========================
   STATE + SCORING MODEL
   ========================= */

const DEFAULT_STATE = {
  trust:50, risk:50, morale:50, ai:50,
  // trait signals accumulate over time
  traits:{
    empathy:0, coaching:0, task_focus:0, adaptability_ai:0,
    self_awareness:0, conflict_tolerance:0, resilience:0, bias_risk:0
  },
  miniUnlocked:[],
  // history: for export/import + back
  history:[], // {seasonId, ep, choiceIndex, ts}
  // navigation
  currentSeasonId:"S1",
  currentEpisodeIndex:0,
  lastOutcome:null
};

let state = loadState();

function clamp(n){ return Math.max(0, Math.min(100, n)); }
function nowISO(){ return new Date().toISOString(); }

function loadState(){
  try{
    const raw = localStorage.getItem("cultureShiftState");
    if(!raw) return structuredClone(DEFAULT_STATE);
    const parsed = JSON.parse(raw);
    // shallow merge safety
    return Object.assign(structuredClone(DEFAULT_STATE), parsed);
  }catch{
    return structuredClone(DEFAULT_STATE);
  }
}
function saveState(){
  localStorage.setItem("cultureShiftState", JSON.stringify(state));
}

/* =========================
   UI HELPERS
   ========================= */

function setBar(el, value, flavor){
  el.style.width = value + "%";
  // auto-flavor
  let color;
  if(flavor==="risk"){
    // low risk = good, high risk = bad
    color = value<=35 ? "var(--good)" : value<=65 ? "var(--warn)" : "var(--bad)";
  } else {
    color = value>=65 ? "var(--good)" : value>=40 ? "var(--warn)" : "var(--bad)";
  }
  el.style.background = color;
}

function traitLabel(k){
  const map = {
    empathy:"Emotional Intelligence",
    coaching:"Coaching Strength",
    task_focus:"Task Focus",
    adaptability_ai:"AI Adaptability",
    self_awareness:"Self-Awareness",
    conflict_tolerance:"Conflict Tolerance",
    resilience:"Resilience",
    bias_risk:"Bias Risk"
  };
  return map[k] || k;
}

function uniquePush(arr, item){
  if(!arr.includes(item)) arr.push(item);
}

/* =========================
   ARCHETYPE + SHADOW TRAITS
   ========================= */

function computeArchetype(){
  const t = state.traits;
  // lightweight heuristics
  const empathy = t.empathy;
  const coaching = t.coaching;
  const task = t.task_focus;
  const ai = t.adaptability_ai;
  const conflict = t.conflict_tolerance;

  // primary style
  if(coaching >= 6 && empathy >= 4) return "Talent Multiplier Coach";
  if(empathy >= 6 && task < 4) return "Relational Safety Builder";
  if(task >= 6 && empathy < 4) return "Operational Driver";
  if(ai >= 6 && coaching >= 4) return "Change Architect";
  if(conflict < -2 && empathy >= 4) return "Harmony-Seeking Avoider";
  return "Balanced Builder";
}

function computeBadge(){
  // simple readiness badge based on final posture
  const t = state.trust, a = state.ai, m = state.morale, r = state.risk;
  if(t>=65 && a>=65 && m>=60 && r<=45) return "Transformation Readiness: GOLD";
  if(t>=55 && a>=55 && r<=55) return "Transformation Readiness: SILVER";
  return "Transformation Readiness: BRONZE";
}

function computeShadowTraits(){
  // derive likely blind spots from metric patterns + trait overuse
  const shadows = [];

  if(state.trust < 40 && state.traits.task_focus > 4) shadows.push("Task-first under pressure (empathy drops)");
  if(state.risk > 60 && state.traits.conflict_tolerance < 0) shadows.push("Avoids hard conversations until late");
  if(state.morale < 40 && state.traits.task_focus > 5) shadows.push("Standards without safety (morale leak)");
  if(state.ai > 70 && state.traits.empathy < 2) shadows.push("Change pacing feels pushy / threatening");
  if(state.traits.bias_risk > 3) shadows.push("In-group favoritism / uneven investment risk");
  if(state.traits.empathy > 7 && state.traits.task_focus < 1) shadows.push("Over-accommodation (clarity/standards too soft)");
  if(state.traits.coaching > 7 && state.traits.task_focus < 1) shadows.push("Coaching without commitments (slow execution)");

  if(shadows.length === 0) shadows.push("No major red flags detected â€” watch consistency under stress.");
  return shadows;
}

function computeRoadmap(){
  const archetype = computeArchetype();
  const shadows = computeShadowTraits();

  // quick personalized roadmap blocks
  let plan = `Archetype: ${archetype}\n\n`;
  plan += `Week 1 â€” Stabilize the basics\nâ€¢ Do 2 structured 1:1s: (1) â€œWhatâ€™s draining you?â€ (2) â€œWhat would make you stay?â€\nâ€¢ Practice one repair phrase per day: â€œIntent vs impact â€” hereâ€™s the standard.â€\n\n`;
  plan += `Week 2 â€” Raise clarity without losing safety\nâ€¢ Set 1 clear expectation with a deadline + success definition.\nâ€¢ Use one boundary script: â€œI care AND this must change.â€\n\n`;
  plan += `Week 3 â€” Build a retention habit\nâ€¢ Run a Stay/Go map with 1 flight-risk signal.\nâ€¢ Do a micro-recognition: specific + impact + future.\n\n`;
  plan += `Week 4 â€” AI-era leadership muscle\nâ€¢ Share a change update: what we know / donâ€™t / next date.\nâ€¢ Choose one low-value task to sunset or automate.\n\n`;
  plan += `Top shadow traits to watch:\nâ€¢ ${shadows.slice(0,3).join("\nâ€¢ ")}\n`;
  return plan;
}

/* =========================
   RENDERING
   ========================= */

function renderTabs(){
  const el = document.getElementById("tabs");
  el.innerHTML = "";
  SEASONS.forEach(s=>{
    const b = document.createElement("div");
    b.className = "tab" + (s.id===state.currentSeasonId ? " active":"");
    b.textContent = s.name;
    b.onclick = ()=>switchSeason(s.id);
    el.appendChild(b);
  });
}

function getSeason(){
  return SEASONS.find(s=>s.id===state.currentSeasonId) || SEASONS[0];
}
function getEpisode(){
  const s = getSeason();
  const i = Math.max(0, Math.min(s.episodes.length-1, state.currentEpisodeIndex));
  return s.episodes[i];
}

function renderDashboard(){
  trust.textContent = state.trust;
  risk.textContent = state.risk;
  morale.textContent = state.morale;
  ai.textContent = state.ai;

  setBar(trustBar, state.trust, "pos");
  setBar(riskBar, state.risk, "risk");
  setBar(moraleBar, state.morale, "pos");
  setBar(aiBar, state.ai, "pos");

  const archetype = computeArchetype();
  const badge = computeBadge();
  archetypePill.textContent = "Archetype: " + archetype;
  badgePill.textContent = "Badge: " + badge;

  // trait tags (show strongest signals)
  const tagEl = document.getElementById("traitTags");
  tagEl.innerHTML = "";
  const entries = Object.entries(state.traits)
    .map(([k,v])=>({k,v}))
    .sort((a,b)=>Math.abs(b.v)-Math.abs(a.v))
    .slice(0,8);

  entries.forEach(e=>{
    const t = document.createElement("span");
    t.className = "tag";
    const dir = e.v>0 ? "â†‘" : e.v<0 ? "â†“" : "â€¢";
    t.textContent = `${traitLabel(e.k)} ${dir} (${e.v})`;
    tagEl.appendChild(t);
  });

  // mini-games unlocked
  const miniEl = document.getElementById("miniTags");
  miniEl.innerHTML = "";
  if(state.miniUnlocked.length===0){
    const t = document.createElement("span");
    t.className="tag";
    t.textContent="â€” None yet (keep playing)";
    miniEl.appendChild(t);
  } else {
    state.miniUnlocked.slice(0,14).forEach(name=>{
      const t = document.createElement("span");
      t.className = "tag";
      t.textContent = name;
      miniEl.appendChild(t);
    });
  }
}

function renderScene(){
  renderTabs();
  renderDashboard();

  const season = getSeason();
  const ep = getEpisode();

  seasonPill.textContent = `Season: ${season.id} â€” ${season.subtitle}`;
  episodePill.textContent = `Episode: ${ep.ep} â€” ${ep.title}`;

  sceneTitle.textContent = ep.sceneTitle;
  sceneText.textContent = ep.text;

  // choices
  const cEl = document.getElementById("choices");
  cEl.innerHTML = "";
  ep.choices.forEach((c, idx)=>{
    const btn = document.createElement("button");
    btn.className = "choiceBtn";
    btn.textContent = c.label;
    btn.onclick = ()=>pickChoice(idx);
    cEl.appendChild(btn);
  });

  // outcome visibility
  if(state.lastOutcome){
    showOutcome(state.lastOutcome);
  } else {
    closeOutcome();
  }
}

function showOutcome(o){
  const oc = document.getElementById("outcomeCard");
  oc.classList.remove("hidden");

  const fmt = v => (v===0||v===undefined) ? "0" : (v>0?`+${v}`:`${v}`);
  outcomeStats.textContent =
    `Trust ${fmt(o.delta.trust)} â€¢ Retention Risk ${fmt(o.delta.risk)} â€¢ Morale ${fmt(o.delta.morale)} â€¢ AI ${fmt(o.delta.ai)}`;
  outcomeReveal.textContent = o.reveal || "â€”";
}
function closeOutcome(){
  const oc = document.getElementById("outcomeCard");
  oc.classList.add("hidden");
  state.lastOutcome = null;
  saveState();
}

/* =========================
   GAME ACTIONS
   ========================= */

function applyDelta(delta){
  state.trust = clamp(state.trust + (delta.trust||0));
  state.risk  = clamp(state.risk  + (delta.risk||0));
  state.morale= clamp(state.morale+ (delta.morale||0));
  state.ai    = clamp(state.ai    + (delta.ai||0));
}

function applyTraits(traits){
  if(!traits) return;
  Object.keys(traits).forEach(k=>{
    if(state.traits[k] === undefined) state.traits[k] = 0;
    state.traits[k] += traits[k];
  });
}

function unlock(minis){
  (minis||[]).forEach(m=>uniquePush(state.miniUnlocked, m));
}

function pickChoice(choiceIndex){
  const season = getSeason();
  const ep = getEpisode();
  const choice = ep.choices[choiceIndex];

  applyDelta(choice.delta || {});
  applyTraits(choice.traits || {});
  unlock(choice.unlock || []);

  // history
  state.history.push({
    seasonId: season.id,
    ep: ep.ep,
    episodeTitle: ep.title,
    choiceIndex,
    choiceLabel: choice.label,
    reveal: choice.reveal,
    delta: choice.delta,
    ts: nowISO()
  });

  // store last outcome (for display)
  state.lastOutcome = { delta: choice.delta, reveal: choice.reveal };

  saveState();
  renderDashboard();
  showOutcome(state.lastOutcome);
  window.scrollTo({top:document.body.scrollHeight, behavior:"smooth"});
}

function switchSeason(seasonId){
  state.currentSeasonId = seasonId;
  state.currentEpisodeIndex = 0;
  state.lastOutcome = null;
  saveState();
  renderScene();
}

function nextScene(){
  const season = getSeason();
  state.currentEpisodeIndex = Math.min(season.episodes.length-1, state.currentEpisodeIndex+1);
  state.lastOutcome = null;
  saveState();
  renderScene();
  window.scrollTo({top:0, behavior:"smooth"});
}

function prevScene(){
  state.currentEpisodeIndex = Math.max(0, state.currentEpisodeIndex-1);
  state.lastOutcome = null;
  saveState();
  renderScene();
  window.scrollTo({top:0, behavior:"smooth"});
}

function resetAll(){
  if(!confirm("Reset all progress, scores, and history?")) return;
  state = structuredClone(DEFAULT_STATE);
  saveState();
  closeAllPanels();
  renderScene();
  window.scrollTo({top:0, behavior:"smooth"});
}

/* =========================
   SCORECARD + EXPORT / IMPORT
   ========================= */

function openScorecard(){
  closeAllPanels();
  scoreCard.classList.remove("hidden");

  const archetype = computeArchetype();
  const badge = computeBadge();
  document.getElementById("scoreArchetype").textContent = "Archetype: " + archetype;
  document.getElementById("scoreBadge").textContent = "Badge: " + badge;

  const shadows = computeShadowTraits();
  const shadowEl = document.getElementById("shadowTags");
  shadowEl.innerHTML = "";
  shadows.forEach(s=>{
    const t = document.createElement("span");
    t.className = "tag";
    t.textContent = s;
    shadowEl.appendChild(t);
  });

  document.getElementById("roadmap").textContent = computeRoadmap();
  window.scrollTo({top:0, behavior:"smooth"});
}
function closeScorecard(){ scoreCard.classList.add("hidden"); }

function openHelp(){ closeAllPanels(); helpCard.classList.remove("hidden"); window.scrollTo({top:0,behavior:"smooth"}); }
function closeHelp(){ helpCard.classList.add("hidden"); }

function openExport(){ closeAllPanels(); exportCard.classList.remove("hidden"); window.scrollTo({top:0,behavior:"smooth"}); }
function closeExport(){ exportCard.classList.add("hidden"); }

function closeAllPanels(){
  helpCard.classList.add("hidden");
  scoreCard.classList.add("hidden");
  exportCard.classList.add("hidden");
}

function buildExportObject(){
  return {
    schema:"culture-shift-v1",
    exportedAt: nowISO(),
    dashboard:{
      trust:state.trust, retentionRisk:state.risk, morale:state.morale, aiReadiness:state.ai,
      archetype: computeArchetype(),
      badge: computeBadge(),
      shadowTraits: computeShadowTraits()
    },
    traitSignals: state.traits,
    miniUnlocked: state.miniUnlocked,
    progress:{
      currentSeasonId: state.currentSeasonId,
      currentEpisodeIndex: state.currentEpisodeIndex
    },
    history: state.history
  };
}

function exportJSON(){
  const obj = buildExportObject();
  jsonArea.value = JSON.stringify(obj, null, 2);
}

function downloadJSON(){
  const obj = buildExportObject();
  const blob = new Blob([JSON.stringify(obj, null, 2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "culture-shift-export.json";
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

function importJSON(){
  try{
    const raw = importArea.value.trim();
    if(!raw) return alert("Paste JSON first.");
    const obj = JSON.parse(raw);
    if(obj.schema !== "culture-shift-v1") return alert("Unsupported schema.");

    // map import â†’ internal state
    state.trust = clamp(obj.dashboard?.trust ?? 50);
    state.risk = clamp(obj.dashboard?.retentionRisk ?? 50);
    state.morale = clamp(obj.dashboard?.morale ?? 50);
    state.ai = clamp(obj.dashboard?.aiReadiness ?? 50);

    state.traits = Object.assign(structuredClone(DEFAULT_STATE.traits), obj.traitSignals || {});
    state.miniUnlocked = Array.isArray(obj.miniUnlocked) ? obj.miniUnlocked : [];
    state.history = Array.isArray(obj.history) ? obj.history : [];

    state.currentSeasonId = obj.progress?.currentSeasonId || "S1";
    state.currentEpisodeIndex = obj.progress?.currentEpisodeIndex || 0;

    state.lastOutcome = null;

    saveState();
    alert("Import successful.");
    closeExport();
    renderScene();
  }catch(e){
    alert("Import failed: " + e.message);
  }
}

/* =========================
   INIT
   ========================= */
renderScene();
</script>

</body>
</html>
